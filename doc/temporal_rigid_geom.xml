<?xml version="1.0" encoding="UTF-8"?>
<!--
   ****************************************************************************
    MobilityDB Manual
    Copyright(c) MobilityDB Contributors

    This documentation is licensed under a Creative Commons Attribution-Share
    Alike 3.0 License: https://creativecommons.org/licenses/by-sa/3.0/
   ****************************************************************************
-->
<chapter xml:id="temporal_rgeo">
	<title>Temporal Rigid Geometries</title>

	<para>
		A <emphasis>temporal rigid geometry</emphasis> type, denoted <varname>trgeometry</varname>, is used to represent the <emphasis>shape</emphasis>, the <emphasis>location</emphasis>, and the <emphasis>orientation</emphasis> of objects within coordinate systems anchored to the Earth's surface or within other astronomical coordinate systems, whereas it is assumed that object is rigid, that is, its shape does not change. As we have seen in <xref linkend="temporal_poses" />, the <varname>pose</varname> type is used to represent the <emphasis>location</emphasis> and the <emphasis>orientation</emphasis> of ojects, while the <varname>tpose</varname> type is used to represent the temporal evolution of these. Thus, since the <emphasis>shape</emphasis> of a temporal rigid geometry does not change, a temporal rigid geometry can be seen as the combination of a rigid geometry and a temporal pose.
	</para>

	<para>The <varname>trgeometry</varname> type has equivalent functionality as the <varname>trgeo</varname> and the <varname>tpose</varname> types. Thus, most functions and operators described in <xref linkend="temporal_poses" /> for these types are also applicable for the <varname>trgeometry</varname> type. In addition, there are specific functions defined for the <varname>trgeometry</varname> type. We cover these functions in this chapter. Throughout this chapter, for clarity, we use the 2D triangle and  3D tetrahedron below as reference geometries in the examples, where sometimes we use omit the coordinates for conciseness.
		<programlisting language="sql" xml:space="preserve" format="linespecific">
-- 2D triangle
SELECT geometry 'Polygon((1 1,2 2,3 1,1 1))';
-- 3D tetrahedron
SELECT ST_GeomFromText('POLYHEDRALSURFACE((
  (0 0 0, 1 0 0, 0 1 0, 0 0 0),
  (0 0 0, 1 0 0, 0 0 1, 0 0 0),
  (1 0 0, 0 1 0, 0 0 1, 1 0 0),
  (0 1 0, 0 0 0, 0 0 1, 0 1 0)))');
</programlisting> 
	</para>

	<sect1 xml:id="temp_rgeo">
		<title>Temporal Rigid Geometry</title>
		<para>The <varname>trgeometry</varname> type allows us to represent the shape of rigid objects together with the evolution in time of their position and orientation. As all temporal types, it comes in three subtypes, namely, <emphasis>instant</emphasis>, <emphasis>sequence</emphasis>, and <emphasis>sequence set</emphasis>. Examples of <varname>trgeometry</varname> values of these subtypes are given next.</para>
		<programlisting language="sql" xml:space="preserve" format="linespecific">
-- Instant subtype
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1)); Pose(Point(1 1),0.5)@2001-01-01';
-- Sequence subtype with discrete interpolation
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1)); {Pose(Point(1 1),0.3)@2001-01-01,
  Pose(Point(1 1),0.5)@2001-01-02, Pose(Point(1 1),0.5)@2001-01-03}';
-- Sequence subtype with linear interpolation
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1)); [Pose(Point(1 1),0.2)@2001-01-01,
  Pose(Point(1 1),0.4)@2001-01-02, Pose(Point(1 1),0.5)@2001-01-03]';
-- Sequence set subtype
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1)); {[Pose(Point(1 1),1)@2001-01-01,
  Pose(Point(2 2),1)@2001-01-02], [Pose(Point(2 2),2)@2001-01-04, 
  Pose(Point(2 2),3)@2001-01-05]}';
</programlisting>
		<para>As for temporal point types, the temporal rigid geometry type accepts type modifiers (or <varname>typmod</varname> in PostgreSQL terminology) to specify the subtype, the dimensionality of the point, and/or the spatial reference identifier (SRID). The possible values for the subtype are <varname>Instant</varname>, <varname>Sequence</varname>, and <varname>SequenceSet</varname> and the possible values for the geometry type are either <varname>Point</varname> or <varname>PointZ</varname>. The three arguments are optional and if any of them is not specified for a column, values of any subtype, dimensionality, and/or SRID are allowed.</para>
		<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(trgeometry(Sequence,5676) 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.2)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]');
/* SRID=5676;POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),0.2)@2001-01-01, 
   Pose(POINT(1 1),0.5)@2001-01-03] */
SELECT trgeometry(Sequence) 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.2)@2001-01-01';
/* ERROR: Temporal subtype of the trgeometry value (Instant) does not match column type 
  (Sequence) */
SELECT trgeometry(PointZ) 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.2)@2001-01-01';
-- Column has Z dimension but the trgeometry value does not
SELECT trgeometry(5676) 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.2)@2001-01-01';
-- ERROR:  Temporal pose SRID (0) does not match column SRID (5676)
</programlisting>

		<para>Temporal rigid geometry values of sequence or sequence set subtype are converted into a normal form so that equivalent values have identical representations. For this, consecutive instant values are merged when possible. Three consecutive instant values can be merged into two if the linear functions defining the evolution of values are the same. Examples of transformation into a normal form are as follows.</para>
		<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01,
  Pose(Point(2 2),0.4)@2001-01-02, Pose(Point(3 3),0.6)@2001-01-03)');
/* POLYGON((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01,
   Pose(Point(3 3),0.6)@2001-01-03) */
SELECT asText(trgeometry 'Polygon((1 1,2 2,3 1,1 1));{[Pose(Point(1 1),0.2)@2001-01-01, 
  Pose(Point(2 2),0.3)@2001-01-02, Pose(Point(2 2),0.5)@2001-01-03),
  [Pose(Point(2 2),0.5)@2001-01-03, Pose(Point(2 2),0.7)@2001-01-04)}');
/* POLYGON((1 1,2 2,3 1,1 1));{[Pose(Point(1 1),0.2)@2001-01-01,
   Pose(Point(2 2),0.3)@2001-01-02, Pose(Point(2 2),0.7)@2001-01-04)} */
</programlisting>
	</sect1>

	<sect1 xml:id="trgeo_validity">
		<title>Validity of Temporal Rigid Geometries</title>

		<para>Temporal pose values must satisfy the constraints specified in <xref linkend="ttype_validity"/> so that they are well defined. An error is raised whenever one of these constraints are not satisfied. Examples of incorrect values are as follows.</para>
		<programlisting language="sql" xml:space="preserve" format="linespecific">
-- Null values are not allowed
SELECT trgeometry 'NULL@2001-01-01 08:05:00';
SELECT trgeometry 'Point(0 0)@NULL';
-- Base type is not a trgeometry
SELECT trgeometry 'Pose(Point(0 0),1)@2001-01-01 08:05:00';
</programlisting>
		<para>We give next the functions and operators for temporal rigid geometries. Most functions and operators for temporal types and spatiotemporal types described in the previous chapters can be applied for temporal rigid geometries. Therefore, in the signatures of the functions, the type type <varname>trgeometry</varname> can be used whenever the types <varname>ttype</varname> and <varname>tspatial</varname> are specified. To avoid redundancy, we only present some examples of these functions and operators for temporal rigid geometries and we refer to previous chapters for detailed explanations about them.</para>
	</sect1>

	<sect1 xml:id="trgeo_inout">
		<title>Input and Output</title>
		<itemizedlist>
			<listitem xml:id="trgeo_asText">
				<indexterm significance="normal"><primary><varname>asText</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>asEWKT</varname></primary></indexterm>
				<para>Return the Well-Known Text (WKT) or the Extended Well-Known Text (EWKT) representation</para>
				<para><varname>asText({trgeometry,trgeometry[]}) → {text,text[]}</varname></para>
				<para><varname>asEWKT({trgeometry,trgeometry[]}) → {text,text[]}</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(0 0),1)@2001-01-01, Pose(Point(1 1),2)@2001-01-02)');
/* POLYGON((1 1,2 2,3 1,1 1));[Pose(Point(0 0),1)@2001-01-01,
   Pose(Point(1 1),2)@2001-01-02) */
SELECT asText(ARRAY[trgeometry 
  'SRID=5676;Polygon((1 1,2 2,3 1,1 1));Pose(Point(0 0),1)@2001-01-01',
  'SRID=5676;Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),2)@2001-01-02']);
/* {"POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(0 0),1)@2001-01-01",
    "POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(1 1),2)@2001-01-02"} */
SELECT asEWKT(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(0 0),1)@2001-01-01, Pose(Point(1 1),2)@2001-01-02)');
/* SRID=5676;POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(0 0),1)@2001-01-01, 
   Pose(POINT(1 1),2)@2001-01-02) */
SELECT asEWKT(ARRAY[trgeometry 
  'SRID=5676;Polygon((1 1,2 2,3 1,1 1));Pose(Point(0 0),1)@2001-01-01',
  'SRID=5676;Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),2)@2001-01-02']);
/* {"SRID=5676;POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(0 0),1)@2001-01-01",
    "SRID=5676;POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(1 1),2)@2001-01-02"} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_asMFJSON">
				<indexterm significance="normal"><primary><varname>asMFJSON</varname></primary></indexterm>
				<para>Return the Moving Features JSON (MF-JSON) representation</para>
				<para><varname>asMFJSON(trgeometry) → text</varname></para>
				<para>The function only supports 2D geometries.</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asMFJSON(trgeometry 'POLYGON((1 1,2 2,3 1,1 1));
  Pose(Point(1 2),0.5)@2001-01-01', 3);
/* {"type":"MovingRigidGeometry","bbox":[[1,2],[1,2]],
  "period":{"begin":"2001-01-01T00:00:00+01",
  "end":"2001-01-01T00:00:00+01","lower_inc":true,"upper_inc":true},
  "values":[{"position":{"lat":2,"lon":1},"rotation":0.5}],
  "geometry":{"type":"Polygon","coordinates":[[[1,1],[2,2],[3,1],[1,1]]]},
  "datetimes":["2001-01-01T00:00:00+01"],"interpolation":"None"} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_asBinary">
				<indexterm significance="normal"><primary><varname>asBinary</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>asEWKB</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>asHexEWKB</varname></primary></indexterm>
				<para>Return the Well-Known Binary (WKB), the Extended Well-Known Binary (EWKB) representation, or the Hexadecimal Extended Well-Known Binary (HexEWKB) representation</para>
				<para><varname>asBinary(trgeometry,endian text='') → bytea</varname></para>
				<para><varname>asEWKB(trgeometry,endian text='') → bytea</varname></para>
				<para><varname>asHexEWKB(trgeometry,endian text='') → text</varname></para>
				<para>The result is encoded using either the little-endian (NDR) or the big-endian (XDR) encoding. If no encoding is specified, then the encoding of the machine is used.</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asBinary(trgeometry 'POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 2),1)@2001-01-01');
-- \x013e000101030000000100000004000000000000000000f03f000000000000f03f000000000000004...
SELECT asEWKB(trgeometry 'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));
  Pose(Point(1 2),1)@2001-01-01');
-- \x013e0041e40e00000103000020e40e00000100000004000000000000000000f03f000000000000f03...
SELECT asHexEWKB(trgeometry 'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));
  Pose(Point(1 2),1)@2001-01-01');
-- 013E0041E40E00000103000020E40E00000100000004000000000000000000F03F000000000000F03F0...
</programlisting>
			</listitem>

			<listitem xml:id="trgeometryFromText">
				<indexterm significance="normal"><primary><varname>trgeometryFromText</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometryFromEWKT</varname></primary></indexterm>
				<para>Input from the Well-Known Text (WKT) representation or from the Extended Well-Known Text (EWKT) representation</para>
				<para><varname>trgeometryFromText(text) → trgeometry</varname></para>
				<para><varname>trgeometryFromEWKT(text) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(trgeometryFromText(text 'POLYGON((1 1,2 2,3 1,1 1));
  [Pose(Point(1 2),1)@2001-01-01, Pose(Point(3 4),2)@2001-01-02]'));
-- POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 2),1)@2001-01-01, Pose(POINT(3 4),2)@2001-01-02]
SELECT asEWKT(trgeometryFromEWKT(text 'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));
  [Pose(Point(1 2),1)@2001-01-01, Pose(Point(3 4),2)@2001-01-02]'));
/* SRID=3812;POLYGON((1 1,2 2,3 1,1 1));[Pose(Point(1 2),1)@2001-01-01,
   Pose(Point(3 4),2)@2001-01-02] */
</programlisting>
			</listitem>

			<listitem xml:id="trgeometryFromMFJSON">
				<indexterm significance="normal"><primary><varname>trgeometryFromMFJSON</varname></primary></indexterm>
				<para>Input from the Moving Features JSON (MF-JSON) representation</para>
				<para><varname>trgeometryFromMFJSON(bytea) → trgeometry</varname></para>
				<para>The function only supports 2D geometries.</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(trgeometryFromMFJSON(asMFJSON(trgeometry 
  'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 2),0.5)@2001-01-01', 3)));
-- SRID=3812;POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(1 2),0.5)@2001-01-01
SELECT asEWKT(trgeometryFromMFJSON(asMFJSON(trgeometry 
  'SRID=5676;POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 2),1)@2001-01-01', 3)));
-- SRID=5676;POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(1 2),1)@2001-01-01
</programlisting>
			</listitem>

			<listitem xml:id="trgeometryFromBinary">
				<indexterm significance="normal"><primary><varname>trgeometryFromBinary</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometryFromEWKB</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometryFromHexEWKB</varname></primary></indexterm>
				<para>Input from the Well-Known Binary (WKB) representation, from the Extended Well-Known Binary (EWKB) representation, or from the Hexadecimal Extended Well-Known Binary (HexEWKB) representation</para>
				<para><varname>trgeometryFromBinary(bytea) → trgeometry</varname></para>
				<para><varname>trgeometryFromEWKB(bytea) → trgeometry</varname></para>
				<para><varname>trgeometryFromHexEWKB(text) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(trgeometryFromBinary(asBinary(trgeometry 
  'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 2),0.5)@2001-01-01')));
-- POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(1 2),1)@2001-01-01
SELECT asEWKT(trgeometryFromEWKB(asEWKB(trgeometry 
  'SRID=3812;POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 2),0.5)@2001-01-01')));
-- SRID=7844;POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 1),2)@2001-01-01
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_constructors">
		<title>Constructors</title>

		<itemizedlist>
			<listitem xml:id="trgeo_const">
				<indexterm significance="normal"><primary><varname>trgeometry</varname></primary></indexterm>
				<para>Constructor for temporal rigid geometries having a constant value</para>
				<para><varname>trgeometry(geom,pose,timestamptz) → trgeometryInst</varname></para>
				<para><varname>trgeometry(geom,pose,tstzset) → trgeometryDiscSeq</varname></para>
				<para><varname>trgeometry(geom,pose,tstzspan,interp='linear') → trgeometryContSeq</varname></para>
				<para><varname>trgeometry(geom,pose,tstzspanset,interp='linear') → trgeometrySeqSet</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometry('Polygon((1 1,2 2,3 1,1 1))', 'Pose(Point(1 1),0.5)',
  timestamptz '2001-01-01'));
-- POLYGON((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.5)@2001-01-01
SELECT asText(trgeometry(geometry 
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)))',
  'Pose(Point Z(1 1 1),0.5,0.5,0.5,0.5)', tstzset '{2001-01-01, 2001-01-05}'));
/* POLYHEDRALSURFACE Z (((...)));{Pose(POINT Z (1 1 1),0.5,0.5,0.5,0.5)@2001-01-01,
  Pose(POINT Z (1 1 1),0.5,0.5,0.5,0.5)@2001-01-05} */
SELECT asText(trgeometry('Polygon((1 1,2 2,3 1,1 1))', 
  'Pose(Point(1 1),0.5)', tstzspan '[2001-01-01, 2001-01-02]'));
-- POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),0.5)@2001-01-01, Pose(POINT(1 1),0.5)@2001-01-02]
SELECT asText(trgeometry('POLYGON((1 1,2 2,3 1,1 1))', 'Pose(Point(1 1),0.2)', 
  tstzspanset '{[2001-01-01, 2001-01-03]}', 'step'));
/* POLYGON((1 1,2 2,3 1,1 1));Interp=Step;{[Pose(Point(1 1),0.2)@2001-01-01,
   Pose(Point(1 1),0.2)@2001-01-03]} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeometrySeq">
				<indexterm significance="normal"><primary><varname>trgeometrySeq</varname></primary></indexterm>
				<para>Constructor for temporal rigid geometry of sequence subtype</para>
				<para><varname>trgeometrySeq(tposeInst[],interp={'step','linear'},leftInc bool=true,</varname></para>
				<para><varname>  rightInc bool=true) → trgeometrySeq</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometrySeq(ARRAY[trgeometry 
  'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.3)@2001-01-01', 
  'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.5)@2001-01-03']));
/* POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),0.3)@2001-01-01,
    Pose(POINT(1 1),0.5)@2001-01-03] */
</programlisting>
			</listitem>

			<listitem xml:id="trgeometrySeqSet">
				<indexterm significance="normal"><primary><varname>trgeometrySeqSet</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometrySeqSetGaps</varname></primary></indexterm>
				<para>Constructor for temporal rigid geometries of sequence set subtype</para>
				<para><varname>trgeoSeqSet(trgeometry[]) → trgeometrySeqSet</varname></para>
				<para><varname>trgeoSeqSetGaps(tposeInst[],maxt=NULL,maxdist=NULL,interp='linear') → tposeSeqSet</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometrySeqSet(ARRAY[trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.2)@2001-01-01, Pose(Point(2 2),0.4)@2001-01-02]', 
  'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(2 2),0.6)@2001-01-03]']));
/* POLYGON((1 1,2 2,3 1,1 1));{[Pose(POINT(1 1),0.2)@2001-01-01,
  Pose(POINT(2 2),0.4)@2001-01-02], [Pose(POINT(2 2),0.6)@2001-01-03]} */
SELECT asText(trgeometrySeqSetGaps(ARRAY[trgeometry 
  'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.1)@2001-01-01', 
  'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.3)@2001-01-03',
  'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.5)@2001-01-05'], '1 day'));
/* POLYGON((1 1,2 2,3 1,1 1));{[Pose(POINT(1 1),0.1)@2001-01-01],
   [Pose(POINT(1 1),0.3)@2001-01-03], [Pose(POINT(1 1),0.5)@2001-01-05]} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_geom_tpose">
				<indexterm significance="normal"><primary><varname>trgeometry</varname></primary></indexterm>
				<para>Construct a temporal rigid geometry from a geometry and a temporal pose</para>
				<para><varname>trgeometry(geometry, tpose) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometry(geometry 'Polygon((1 1,2 2,3 1,1 1))',
  tpose '[Pose(Point(1 1),1)@2001-01-01, Pose(Point(1 1),2)@2001-01-02)'));
-- POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),1)@2001-01-01, Pose(POINT(1 1),2)@2001-01-02)
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_conversions">
		<title>Conversions</title>
		<para>A temporal rigid geometry can be converted to a temporal pose. This can be done using an explicit <varname>CAST</varname> or using the <varname>::</varname> notation. A null value is returned if any of the composing geometry point values cannot be converted into a <varname>pose</varname> value.</para>
		<itemizedlist>
			<listitem xml:id="trgeo_to_tpose">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Convert a temporal rigid geometry into a temporal pose</para>
				<para><varname>trgeometry::tpose</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText((trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01,
  Pose(Point(1 1),0.3)@2001-01-02)')::tpose);
-- [Pose(POINT(1 1),0.2)@2001-01-01, Pose(POINT(1 1),0.3)@2001-01-02)
SELECT asEWKT((trgeometry 'SRID=5676;
  POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  [Pose(Point Z(1 1 1),0.5,0.5,0.5,0.5)@2001-01-01,
  Pose(Point Z(2 2 2),1,0,0,0)@2001-01-02)')::tpose);
/* SRID=5676;[Pose(POINT Z (1 1 1),0.5,0.5,0.5,0.5@2001-01-01,
   Pose(POINT Z (2 2 2),1,0,0,0@2001-01-02) */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_to_tpoint">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Convert a temporal rigid geometry into a temporal point</para>
				<para><varname>trgeometry::tgeompoint</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText((trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01,
  Pose(Point(1 1),0.3)@2001-01-02)')::tgeompoint);
-- [POINT(1 1)@2001-01-01, POINT(1 1)@2001-01-02)
SELECT asEWKT((trgeometry 'SRID=5676;
  POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  [Pose(Point Z(1 1 1),0.5,0.5,0.5,0.5)@2001-01-01,
  Pose(Point Z(2 2 2),1,0,0,0)@2001-01-02)')::tgeompoint);
-- SRID=5676;[POINT Z (1 1 1)@2001-01-01, POINT Z (2 2 2)@2001-01-02)
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_to_geo">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Convert a temporal rigid geometry into a geometry</para>
				<para><varname>trgeometry::geometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT ST_AsText((trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01,
  Pose(Point(1 1),0.3)@2001-01-02)')::geometry);
-- POLYGON((1 1,2 2,3 1,1 1))
SELECT ST_AsEWKT((trgeometry
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  [Pose(Point Z(1 1 1),0.5,0.5,0.5,0.5)@2001-01-01,
  Pose(Point Z(2 2 2),1,0,0,0)@2001-01-02)')::geometry);
/* POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0))) */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_accessors">
		<title>Accessors</title>
		<itemizedlist>
			<listitem xml:id="trgeo_geo">
				<indexterm significance="normal"><primary><varname>geometry</varname></primary></indexterm>
				<para>Return the reference geometry</para>
				<para><varname>geometry(trgeometry) → geom</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT ST_AsEWKT(geometry(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  {Pose(Point(3 3),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-02}'));
-- SRID=5676;POLYGON((1 1,2 2,3 1,1 1))
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_tpose">
				<indexterm significance="normal"><primary><varname>tpose</varname></primary></indexterm>
				<para>Return the temporal pose</para>
				<para><varname>tpose(trgeometry) → tpose</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(tpose(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  {[Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-02)}'));
-- SRID=5676;{[Pose(POINT(1 1),0.3)@2001-01-01, Pose(POINT(1 1),0.3)@2001-01-02)}
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_tgeompoint">
				<indexterm significance="normal"><primary><varname>tgeompoint</varname></primary></indexterm>
				<para>Return the temporal point</para>
				<para><varname>tgeompoint(trgeometry) → tgeompoint</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(tgeompoint(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  {[Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-02)}'));
-- SRID=5676;{[POINT(1 1)@2001-01-01 00:00:00+01, POINT(1 1)@2001-01-02 00:00:00+01)}
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_valueAtTimestamp">
				<indexterm significance="normal"><primary><varname>valueAtTimestamp</varname></primary></indexterm>
				<para>Return the value at a timestamp</para>
				<para><varname>valueAtTimestamp(trgeometry,timestamptz) → geometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT ST_AsText(valueAtTimestamp(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0)@2001-01-01, Pose(Point(3 3), 3.141592653589793)@2001-01-03)', '2001-01-02'));
-- POLYGON((2 2,3 3,2 4,2 2))
SELECT ST_AsText(valueAtTimestamp(trgeometry 
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  [Pose(Point Z(1 1 1),0.5,0.5,0.5,0.5)@2001-01-01,
    Pose(Point Z(3 3 3),1,0,0,0)@2001-01-03)', timestamptz '2001-01-02'),3);
/* POLYHEDRALSURFACE Z (((2 2 2,2.667 2.667 1.667,1.667 2.667 2.667,2 2 2),
  (2 2 2,2.667 2.667 1.667,2.667 1.667 2.667,2 22),
  (2.667 2.667 1.667,1.667 2.667 2.667,2.667 1.667 2.667,2.667 2.667 1.667),
  (1.667 2.667 2.667,2 2 2,2.667 1.667 2.667,1.667 2.667 2.667))) */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_transformations">
		<title>Transformations</title>
		<itemizedlist>
			<listitem xml:id="trgeo_subtype">
				<indexterm significance="normal"><primary><varname>trgeometryInst</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometrySeq</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>trgeometrySeqSet</varname></primary></indexterm>
				<para>Transform to another subtype</para>
				<para><varname>trgeometryInst(trgeometry) → trgeoInst</varname></para>
				<para><varname>trgeometrySeq(trgeometry) → trgeoSeq</varname></para>
				<para><varname>trgeometrySeqSet(trgeometry) → trgeoSeqSet</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(trgeometrySeq(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  Pose(Point(1 1),0.5)@2001-01-01', 'discrete'));
-- POLYGON((1 1,2 2,3 1,1 1));{Pose(Point(1 1),0.5)@2001-01-01}
SELECT asText(trgeometrySeq(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  Pose(Point(1 1),0.5)@2001-01-01'));
-- POLYGON((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.5)@2001-01-01]
SELECT asText(trgeometrySeqSet(trgeometry
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  Pose(PointZ(1 1 1),0.5,0.5,0.5,0.5)@2001-01-01'));
-- POLYHEDRALSURFACE Z (((...)));{[Pose(POINT Z (1 1 1),0.5,0.5,0.5,0.5@2001-01-01]}
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_setInterp">
				<indexterm significance="normal"><primary><varname>setInterp</varname></primary></indexterm>
				<para>Transform to another interpolation</para>
				<para><varname>setInterp(trgeometry, interp) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(setInterp(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  Pose(Point(1 1),0.2)@2001-01-01','linear'));
-- POLYGON((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01]
SELECT asText(setInterp(trgeometry
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  {[Pose(Point Z(1 1 1),1,0,0,0)@2001-01-01],[Pose(Point Z(2 2 2),0,0,0,1)@2001-01-02]}',
  'discrete'));
/* POLYHEDRALSURFACE Z (((...)));{Pose(POINT Z (1 1 1),1,0,0,0)@2001-01-01,
   Pose(POINT Z (2 2 2),0,0,0,1)@2001-01-02} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_round">
				<indexterm significance="normal"><primary><varname>round</varname></primary></indexterm>
				<para>Round the points and the orientations of the temporal rigid geometry to the number of decimal places</para>
				<para><varname>round(trgeometry,integer=0) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(round(trgeometry 'Polygon((1.123456789 1,2 2,3 1,1.123456789 1));
  {[Pose(Point(1 1.123456789),0.123456789)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-02)}', 3));
/* Polygon((1.123 1,2 2,3 1,1.123 1));{[Pose(POINT(1 1.123),0.123)@2001-01-01,
   Pose(POINT(1 1),0.5)@2001-01-02)} */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_modifications">
		<title>Modifications</title>
		<itemizedlist>
			<listitem xml:id="trgeo_appendInstant">
				<indexterm significance="normal"><primary><varname>appendInstant</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>appendSequence</varname></primary></indexterm>
				<para>Append a temporal instant or a temporal sequence</para>
				<para><varname>appendInstant(trgeometry,trgeometryInst) → trgeometry</varname></para>
				<para><varname>appendSequence(trgeometry,trgeometrySeq) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(appendInstant(
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.5)@2001-01-01', 
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(2 2),1)@2001-01-02'));
/* POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),0.5)@2001-01-01,
  Pose(POINT(2 2),1)@2001-01-02] */
SELECT asText(appendSequence(
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.5)@2001-01-01]', 
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(2 2),1)@2001-01-02]'));
/* POLYGON((1 1,2 2,3 1,1 1));{[Pose(POINT(1 1),0.5)@2001-01-01],
   [Pose(POINT(2 2),1)@2001-01-02]} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_merge">
				<indexterm significance="normal"><primary><varname>merge</varname></primary></indexterm>
				<para>Merge the temporal rigid geometries</para>
				<para><varname>merge(trgeometry,trgeometry) → trgeometry</varname></para>
				<para><varname>merge(trgeometry[]) → trgeometry</varname></para>
				<para><varname>merge(trgeometry) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(merge(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.5)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-02]',
  'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.7)@2001-01-02, Pose(Point(3 3),0.2)@2001-01-03]'));
/* POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(1 1),0.5)@2001-01-01,
  Pose(POINT(2 2),0.7)@2001-01-02, Pose(POINT(3 3),0.2)@2001-01-03] */
SELECT asText(merge(ARRAY[trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  {[Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(2 2),0.2)@2001-01-02],
    [Pose(Point(3 3),0.3)@2001-01-03, Pose(Point(4 4),0.4)@2001-01-04]}',
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(4 4),0.4)@2001-01-04, Pose(Point(5 5),0.5)@2001-01-05]']));
/* POLYGON((1 1,2 2,3 1,1 1));
  {[Pose(POINT(1 1),0.1)@2001-01-01, Pose(POINT(2 2),0.2)@2001-01-02], 
   [Pose(POINT(3 3),0.3)@2001-01-03, Pose(POINT(5 5),0.5)@2001-01-05]} */
WITH Temp(inst) AS (
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(1 1),0.1)@2001-01-01' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(2 2),0.2)@2001-01-02' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));Pose(Point(3 3),0.3)@2001-01-03' )
SELECT asText(merge(inst)) FROM Temp;
/* POLYGON((1 1,2 2,3 1,1 1)); {Pose(POINT(1 1),0.1)@2001-01-01, 
   Pose(POINT(2 2),0.2)@2001-01-02, Pose(POINT(3 3),0.3)@2001-01-03} */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_restrictions">
		<title>Restrictions</title>
		<itemizedlist>
			<listitem xml:id="trgeo_atGeometry">
				<indexterm significance="normal"><primary><varname>atGeometry</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>minusGeometry</varname></primary></indexterm>
				<para>TODO Restrict to (the complement of) a geometry</para>
				<para><varname>atGeometry(trgeometry,geometry) → trgeometry</varname></para>
				<para><varname>minusGeometry(trgeometry,geometry) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT atGeometry(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-03]',
  geometry 'Polygon((40 40,40 50,50 50,50 40,40 40))');
SELECT minusGeometry(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-03]',
  geometry 'Polygon((40 40,40 50,50 50,50 40,40 40))');
/* {(Pose(Point(2 2),0.342593)@2001-01-01 05:06:40.364673+01,
   Pose(Point(2 2),0.7)@2001-01-03]} */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_atStbox">
				<indexterm significance="normal"><primary><varname>atStbox</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>minusStbox</varname></primary></indexterm>
				<para>TODO Restrict to (the complement of) a spatiotemporal box</para>
				<para><varname>atStbox(trgeometry,stbox) → trgeometry</varname></para>
				<para><varname>minusStbox(trgeometry,stbox) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT atStbox(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-03]',
  stbox 'STBOX X((40,40),(50,50))');
SELECT minusStbox(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-03]',
  stbox 'STBOX X((40,40),(50,50))');
/* {(Pose(Point(2 2),0.342593)@2001-01-01 05:06:40.364673+01,
   Pose(Point(2 2),0.7)@2001-01-03]} */
</programlisting>
			</listitem>

		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_srid">
		<title>Spatial Reference System</title>
		<itemizedlist>
			<listitem xml:id="trgeo_SRID">
				<indexterm significance="normal"><primary><varname>SRID</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>setSRID</varname></primary></indexterm>
				<para>Return or set the spatial reference identifier</para>
				<para><varname>SRID(trgeometry) → integer</varname></para>
				<para><varname>setSRID(trgeometry) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT SRID(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(0 0),1)@2001-01-01, Pose(Point(1 1),2)@2001-01-02)');
-- 5676
SELECT asEWKT(setSRID(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(0 0),1)@2001-01-01, Pose(Point(1 1),2)@2001-01-02)', 5676));
/* SRID=5676;POLYGON((1 1,2 2,3 1,1 1));[Pose(POINT(0 0),1)@2001-01-01,
   Pose(POINT(1 1),2)@2001-01-02) */
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_transform">
				<indexterm significance="normal"><primary><varname>transform</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>transformPipeline</varname></primary></indexterm>
				<para>Transform to a spatial reference identifier</para>
				<para><varname>transform(trgeometry,integer) → trgeometry</varname></para>
				<para><varname>transformPipeline(trgeometry,pipeline text,to_srid integer,is_forward bool=true) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asEWKT(transform(trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
  Pose(Point(1 1),1)@2001-01-01', 3812), 3);
/* SRID=3812;POLYGON((-2467300.705 -5237214.466,-2467299.106 -5237213.566,
     -2467298.206 -5237215.165,-2467300.705 -5237214.466));
   Pose(POINT(-2467300.705 -5237214.466),1)@2001-01-01 */
</programlisting>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
WITH test(trgeometry, pipeline) AS (
  SELECT trgeometry 'SRID=5676;Polygon((1 1,2 2,3 1,1 1));
    {Pose(Point(1 1),1)@2001-01-01, Pose(Point(2 2),2)@2001-01-02}',
    text 'urn:ogc:def:coordinateOperation:EPSG::16031' )
SELECT asEWKT(transformPipeline(transformPipeline(trgeometry, pipeline, 5676), pipeline,
  5676, false), 6)
FROM test;
/* SRID=5676;POLYGON((1 1,2 2,3 1,1 1));{Pose(POINT(1 1),1)@2001-01-01, 
   Pose(POINT(2 2),2)@2001-01-02} */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_bbox_ops">
		<title>Bounding Box Operations</title>
		<itemizedlist>
			<listitem xml:id="trgeo_topo">
				<indexterm significance="normal"><primary><varname>&amp;&amp;</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>&lt;@</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>@&gt;</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>~=</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>-|-</varname></primary></indexterm>
				<para>Topological operators</para>
				<para><varname>{tstzspan,stbox,trgeometry} {&amp;&amp;, &lt;@, @&gt;, ~=, -|-} {tstzspan,stbox,trgeometry} → </varname></para>
				<para><varname>  boolean</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01,
  Pose(Point(1 1),0.5)@2001-01-03]' &amp;&amp; tstzspan '[2001-01-02,2001-01-04]';
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01,
  Pose(Point(1 1),0.5)@2001-01-02]' @&gt; stbox(pose 'Pose(Point(1 1),0.5)');
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-03]' ~= 
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.35)@2001-01-02, Pose(Point(1 1),0.5)@2001-01-03]';
-- true
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_pos">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Position operators</para>
				<para><varname>{stbox,trgeometry} {&lt;&lt;, &amp;&lt;, &gt;&gt;, &amp;&gt;} {stbox,trgeometry}  → boolean</varname></para>
				<para><varname>{stbox,trgeometry} {&lt;&lt;|, &amp;&lt;|, |&gt;&gt;, |&amp;&gt;} {stbox,trgeometry}  → boolean</varname></para>
				<para><varname>{stbox,trgeometry} {&lt;&lt;/, &amp;&lt;/, /&gt;&gt;, /&amp;&gt;} {stbox,trgeometry}  → boolean</varname></para>
				<para><varname>{tstzspan,stbox,trgeometry} {&lt;&lt;#, &amp;&lt;#, #&gt;&gt;, #&amp;&gt;} {tstzspan,stbox,trgeometry} → boolean</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-02]' &lt;&lt; stbox(pose 'Pose(Point(2 2),0.5)');
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01,
  Pose(Point(1 1),0.5)@2001-01-02]' &lt;&lt;| stbox(pose 'Pose(Point(2 2),0.5)');
-- true
SELECT trgeometry 
  'POLYHEDRALSURFACE(((0 0 0, 1 0 0, 0 1 0, 0 0 0),(0 0 0, 1 0 0, 0 0 1, 0 0 0),
    (1 0 0, 0 1 0, 0 0 1, 1 0 0),(0 1 0, 0 0 0, 0 0 1, 0 1 0)));
  [Pose(Point(1 1 1),1,0,0,0)@2001-01-01, Pose(Point(1 1 1),1,0,0,0)@2001-01-02]' &lt;&lt;/
  stbox(pose 'Pose(Point(2 2 2),1,0,0,0)');
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-02]' &lt;&lt;# tstzspan '[2001-01-03, 2001-01-04]';
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1)); [Pose(Point(1 1),0.3)@2001-01-03,
  Pose(Point(1 1),0.5)@2001-01-05]' #&gt;&gt; trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-02]';
-- true
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_distance">
		<title>Distance Operations</title>
		<para>
			We present next the functions that compute distance operations for temporal rigid geometries. Notice that for these operations only the point component is considered, not the orientation.
		</para>
		<itemizedlist>
			<listitem xml:id="trgeo_nearestApproachDistance">
				<indexterm significance="normal"><primary><varname>|=|</varname></primary></indexterm>
				<para>Return the smallest distance ever</para>
				<para><varname>{geo,trgeometry} |=| {geo,trgeometry} → float</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-02]' |=|
  geometry 'Polygon((50 50,50 55,55 55,55 50,50 50))';
-- 67.88225099390856
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-03]' |=| trgeometry 'Polygon((1 1,5 5,5 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]';
-- Function tdistance_trgeo_trgeo not implemented yet.
</programlisting>
				<para>The operator <varname>|=|</varname>  can be used for doing nearest neightbor searches using GiST or SP-GiST indexes (see <xref linkend="ttype_indexing"/>).</para>
			</listitem>

			<listitem xml:id="trgeo_nearestApproachInstant">
				<indexterm significance="normal"><primary><varname>nearestApproachInstant</varname></primary></indexterm>
				<para>Return the instant of the first temporal rigid geometry at which the two arguments are at the nearest distance</para>
				<para><varname>nearestApproachInstant({geo,trgeometry},{geo,trgeometry}) → trgeometry</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT asText(nearestApproachInstant(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-02]',
  geometry 'Polygon((50 50,50 55,55 55,55 50,50 50))'));
-- POLYGON((1 1,2 2,3 1,1 1));Pose(POINT(2 2),0.3)@2001-01-01
SELECT asText(nearestApproachInstant(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]', 
  trgeometry 'Polygon((1 1,5 5,5 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]'));
-- Function tdistance_trgeo_trgeo not implemented yet.
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_shortestLine">
				<indexterm significance="normal"><primary><varname>shortestLine</varname></primary></indexterm>
				<para>Return the line connecting the nearest approach point</para>
				<para><varname>shortestLine({geo,trgeometry},{geo,trgeometry}) → geometry</varname></para>
				<para>The function will only return the first line that it finds if there are more than one.</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT ST_AsText(shortestLine(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.3)@2001-01-01, Pose(Point(2 2),0.7)@2001-01-02]',
  geometry 'Polygon((50 50,50 55,55 55,55 50,50 50))'));
--  LINESTRING(2e-323 3.250856695786946,2.5e-323 50)
SELECT ST_AsText(shortestLine(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]', 
  trgeometry 'Polygon((1 1,5 5,5 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]'));
-- Function tdistance_trgeo_trgeo not implemented yet.
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_tdistance">
				<indexterm significance="normal"><primary><varname>&lt;-&gt;</varname></primary></indexterm>
				<para>Return the temporal distance</para>
				<para><varname>trgeometry &lt;-&gt; geometry → tfloat</varname></para>
				<para><varname>trgeometry &lt;-&gt; trgeometry → tfloat</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT round(trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(1 1),0.5)@2001-01-03]' &lt;-&gt; geometry 'Point(50 50)', 6);
/* [{66.178442@2001-01-01 00:00:00+01, 66.134187@2001-01-02 15:16:31.534126+01,
    66.136376@2001-01-03 00:00:00+01} */
SELECT round(trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.3)@2001-01-01, 
  Pose(Point(2 2),0.5)@2001-01-03]' &lt;-&gt; trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 2),0.3)@2001-01-02, Pose(Point(2 1),0.5)@2001-01-04]', 6);
-- Function tdistance_trgeo_trgeo not implemented yet.
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_spatial_rels">
		<title>Spatial Relationships</title>
		<para>
			The topological and distance relationships described in <xref linkend="tgeo_spatial_rel"/> such as <varname>eIntersects</varname>, <varname>aDwithin</varname>, or <varname>tContains</varname> only consider the location of the geometries, not their orientation. To be able to apply these spatial relationships to the temporal rigid geometries, they must be transformed to temporal geometry points. This can be easily performed using the functions <varname>geometry</varname> and <varname>tgeompoint</varname> or using an explicit casting <varname>::</varname> as shown in the examples below.
		</para>

		<itemizedlist>
			<listitem xml:id="trgeo_espatialrels">
				<para>Ever and always relationships</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT eContains(geometry 'Polygon((0 0,0 50,50 50,50 0,0 0))', 
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.1)@2001-01-01,
  Pose(Point(1 1),0.3)@2001-01-03)');
-- true
SELECT eDisjoint(geometry 'Point(2 2)', trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)'));
-- true
SELECT eIntersects(trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)',
  trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(2 2),0.0)@2001-01-01, Pose(Point(2 2),1)@2001-01-03)');
-- false
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_tspatialrels">
				<para>Spatiotemporal relationships</para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT tContains(geometry 'Polygon((0 0,0 50,50 50,50 0,0 0))', trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)');
-- {[t@2001-01-01, t@2001-01-03)}
SELECT tDisjoint(geometry(pose 'Pose(Point(2 2),0.0)'),
  tgeompoint(trgeometry '[Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)'));
-- [t@2001-01-01, t@2001-01-03)
SELECT tDwithin(
 trgeometry '[Pose(Point(1 1),0.3)@2001-01-01,Pose(Point(1 1),0.5)@2001-01-03)'::tgeompoint, 
 trgeometry '[Pose(Point(1 1),0.5)@2001-01-01,Pose(Point(3 3),0.3)@2001-01-03)'::tgeompoint,1);
/* {[t@2001-01-01 00:00:00+01, t@2001-01-01 16:58:14.025894+01],
  (f@2001-01-01 16:58:14.025894+01, f@2001-01-03 00:00:00+01)} */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_comparisons">
		<title>Comparisons</title>
		<itemizedlist>
			<listitem xml:id="trgeo_comp">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Traditional comparisons</para>
				<para><varname>trgeometry {=, &lt;&gt;, &lt;, &gt;, &lt;=, &gt;=} trgeometry → boolean</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));{[Pose(Point(1 1),0.1)@2001-01-01, 
  Pose(Point(1 1),0.3)@2001-01-02), [Pose(Point(1 1),0.3)@2001-01-02,
  Pose(Point(1 1),0.5)@2001-01-03]}' = trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]';
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));{[Pose(Point(1 1),0.1)@2001-01-01, 
  Pose(Point(1 1),0.3)@2001-01-02), [Pose(Point(1 1),0.3)@2001-01-02,
  Pose(Point(1 1),0.5)@2001-01-03]}' &lt;&gt; trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]';
-- false
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));{[Pose(Point(1 1),0.1)@2001-01-01, 
  Pose(Point(1 1),0.3)@2001-01-02), [Pose(Point(1 1),0.3)@2001-01-02,
  Pose(Point(1 1),0.5)@2001-01-03]}' &lt; trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.5)@2001-01-03]';
-- true
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_ever_always">
				<indexterm significance="normal"><primary><varname>?=</varname></primary></indexterm>
				<indexterm significance="normal"><primary><varname>%=</varname></primary></indexterm>
				<para>Ever and always comparisons</para>
				<para><varname>trgeometry {?=, %=} trgeometry → boolean</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01, 
  Pose(Point(1 1),0.4)@2001-01-04)' ?= geometry 'Polygon((1 1,2 2,3 1,1 1))';
-- true
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01, 
  Pose(Point(1 1),0.2)@2001-01-04)' &amp;= geometry 'Polygon((1 1,2 2,3 1,1 1))';
-- true
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_tcomp">
				<indexterm significance="normal"><primary><varname>::</varname></primary></indexterm>
				<para>Temporal comparisons</para>
				<para><varname>trgeometry {#=, #&lt;&gt;} trgeometry → tbool</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01, 
  Pose(Point(1 1),0.4)@2001-01-03)' #= geometry 'Polygon((1 1,2 2,3 1,1 1))';
-- {[f@2001-01-01, t@2001-01-02], (f@2001-01-02, f@2001-01-03)}
SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));[Pose(Point(1 1),0.2)@2001-01-01, 
  Pose(Point(1 1),0.8)@2001-01-03)' #&lt;&gt; trgeometry 'Polygon((1 1,2 2,3 1,1 1));
  [Pose(Point(1 1),0.3)@2001-01-01, Pose(Point(1 1),0.7)@2001-01-03)';
-- {[t@2001-01-01, f@2001-01-02], (t@2001-01-02, t@2001-01-03)}
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_aggregations">
		<title>Aggregations</title>
		<para>The three aggregate functions for temporal rigid geometries are illustrated next.</para>

		<itemizedlist>
			<listitem xml:id="trgeo_tCount">
				<indexterm significance="normal"><primary><varname>tCount</varname></primary></indexterm>
				<para>Temporal count</para>
				<para><varname>tCount(trgeometry) → {tintSeq,tintSeqSet}</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
WITH Temp(temp) AS (
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.2)@2001-01-02, Pose(Point(1 1),0.4)@2001-01-04)' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.3)@2001-01-03, Pose(Point(1 1),0.5)@2001-01-05)' )
SELECT tCount(Temp)
FROM Temp;
-- {[1@2001-01-01, 2@2001-01-02, 1@2001-01-04, 1@2001-01-05)}
</programlisting>
			</listitem>

			<listitem xml:id="trgeo_wCount">
				<indexterm significance="normal"><primary><varname>wCount</varname></primary></indexterm>
				<para>Window count</para>
				<para><varname>wCount(trgeometry) → {tintSeq,tintSeqSet}</varname></para>
				<programlisting language="sql" xml:space="preserve" format="linespecific">
WITH Temp(temp) AS (
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.1)@2001-01-01, Pose(Point(1 1),0.3)@2001-01-03)' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.2)@2001-01-02, Pose(Point(1 1),0.4)@2001-01-04)' UNION
  SELECT trgeometry 'Polygon((1 1,2 2,3 1,1 1));
    [Pose(Point(1 1),0.3)@2001-01-03, Pose(Point(1 1),0.5)@2001-01-05)' )
SELECT wCount(Temp, '1 day')
FROM Temp;
/* {[1@2001-01-01, 2@2001-01-02, 3@2001-01-03, 2@2001-01-04, 1@2001-01-05,
   1@2001-01-06)} */
</programlisting>
			</listitem>
		</itemizedlist>
	</sect1>

	<sect1 xml:id="trgeo_indexing">
		<title>Indexing</title>

		<para>GiST and SP-GiST indexes can be created for table columns of temporal rigid geometries. An example of index creation is follows:</para>
		<programlisting language="sql" xml:space="preserve" format="linespecific">
CREATE INDEX Trips_Trip_SPGist_Idx ON Trips USING SPGist(Trip);
</programlisting>
		<para>The GiST and SP-GiST indexes store the bounding box for the temporal rigid geometries, which is an <varname>stbox</varname>, as all spatiotemporal types.</para>

		<para>A GiST or SP-GiST index can accelerate queries involving the following operators:</para>
		<itemizedlist>
			<listitem>
				<para><varname>&lt;&lt;</varname>, <varname>&amp;&lt;</varname>, <varname>&amp;&gt;</varname>, <varname>&gt;&gt;</varname>, <varname>&lt;&lt;|</varname>, <varname>&amp;&lt;|</varname>, <varname>|&amp;&gt;</varname>, <varname>|&gt;&gt;</varname>, which only consider the spatial dimension in temporal rigid geometries,</para>
			</listitem>
			<listitem>
				<para><varname>&lt;&lt;#</varname>, <varname>&amp;&lt;#</varname>, <varname>#&amp;&gt;</varname>, <varname>#&gt;&gt;</varname>, which only consider the time dimension in temporal rigid geometries,</para>
			</listitem>
			<listitem>
				<para><varname>&amp;&amp;</varname>, <varname>@&gt;</varname>, <varname>&lt;@</varname>, <varname>~=</varname>, <varname>-|-</varname>, and <varname>|=|</varname> , which consider as many dimensions as they are shared by the indexed column and the query argument.</para>
			</listitem>
		</itemizedlist>
		<para>These operators work on bounding boxes, not the entire values.</para>
	</sect1>
</chapter>

